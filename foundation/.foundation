
#
# foundation...
#

export HISTSIZE=100000
export SAVEHIST=100000
HISTFILE=~/.zsh_history
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt EXTENDED_HISTORY

autoload -Uz edit-command-line
zle -N edit-command-line
bindkey '^X^E' edit-command-line

autoload -Uz compinit && compinit -C
source <(carapace _carapace)

alias vi=nvim
alias lzg=lazygit
alias lzd=lazydocker
alias y=yazi
alias gdu=gdu-go
alias ls="eza --git-ignore"
alias la="ls -lah"
alias lat="la -T"
alias gst="git status"
alias gd="git diff"
alias gp="git push"
alias ga="git add"
#alias gcam="git commit --all --message"
unalias gcam 2>/dev/null
gcam() {
  git add -A

  if git diff --cached --quiet; then
    echo "No changes to commit"
    return 1
  fi

  local diff msg tmp editor_cmd
  diff="$(git diff --cached)"

  msg="$(
    printf "<diff>\n%s\n</diff>" "$diff" | claude -p \
      "Write a commit message for this diff." \
      --output-format text
  )" || return 1

  tmp="$(mktemp "${TMPDIR:-/tmp}/gcam.XXXXXX")" || return 1
  trap 'rm -f "$tmp"' EXIT INT TERM
  printf "%s\n" "$msg" > "$tmp"

  editor_cmd="${VISUAL:-${EDITOR:-vi}}"
  "$editor_cmd" "$tmp" || return 1

  msg="$(cat "$tmp")"
  msg="${msg#"${msg%%[![:space:]]*}"}"
  msg="${msg%"${msg##*[![:space:]]}"}"

  [ -n "$msg" ] || { echo "Commit aborted (empty message)"; return 1; }

  git commit -F "$tmp"
}

set -o vi # enable vim motions in shell text

export EDITOR=vi
export API_TIMEOUT_MS=900000 

source <(fzf --zsh)
export FZF_DEFAULT_COMMAND='fd --type f --strip-cwd-prefix --hidden --follow --exclude .git'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
_fzf_compgen_path() {
  fd --hidden --follow --exclude ".git" . "$1"
}
_fzf_compgen_dir() {
  fd --type d --hidden --follow --exclude ".git" . "$1"
}

eval "$(zoxide init zsh --cmd cd)"
eval "$(direnv hook zsh)"
eval "$(starship init zsh)"

